# Bun + Node + TS
FROM oven/bun:1.1 as build
WORKDIR /app
COPY . .
RUN bun install && bun run build         # tsc / transpile
RUN curl -LO https://stockfishchess.org/files/stockfish_16.1_linux_x86-64-avx2.zip \
    && unzip stockfish_*.zip -d /usr/local/bin/ \
    && chmod +x /usr/local/bin/stockfish

FROM debian:bookworm-slim
COPY --from=build /app /app
COPY --from=build /usr/local/bin/stockfish /usr/local/bin/stockfish
WORKDIR /app
ENV NODE_ENV=production
CMD ["bun","dist/worker.js"]